#!/bin/sh
#
# Tiny Tazpanel cmdline interface
#
# Copyright (C) 2011 SliTaz GNU/Linux - BSD License
#
VERSION=1.0

# Get the configuration file and functions
CONFIG="/etc/slitaz/tazpanel.conf"
[ -f $CONFIG ] && . $CONFIG
[ -f data/tazpanel.conf ] && . data/tazpanel.conf
[ ! -f $PANEL/lib/libtazpanel ] && \
	echo "No config file or libtazpanel found: $CONFIG" && exit 1
. $PANEL/lib/libtazpanel
. /usr/lib/slitaz/libtaz
source_lib commons

# I18n
. /usr/bin/gettext.sh
TEXTDOMAIN='tazpanel'
export TEXTDOMAIN

#
# Commands
#

NAME=tazpanel
DESC="SliTaz administration and configuration panel."
DAEMON=/usr/sbin/httpd
PIDFILE=/var/run/$NAME.pid

case "$1" in
	start)
		gettext "Starting TazPanel web server on port $HTTPD_PORT..."
		httpd -p $HTTPD_PORT -u root -c $HTTPD_CONF \
			-r "$(gettext "TazPanel Authentication - Default: root:root")" &
		ps | grep "httpd -p $HTTPD_PORT " | grep -v grep | \
			awk '{ print $1 }' > $PIDFILE
		status ;;
	stop)
		gettext "Stopping TazPanel web server..."
		kill $(cat $PIDFILE) && status ;;
	passwd|-p)
		echo ""
		gettext "Changing password for TazPanel"
		gettext "New password: " && read pass
		sed -i s"/\/:root:.*/\/:root:$pass/" $HTTPD_CONF
		gettext "Password changed successfully"; echo
		echo "" ;;
	*)
		echo ""
		gettext "Usage:" && echo " $(basename $0) [start|stop|passwd]"
		echo "" ;;
esac

exit 0
